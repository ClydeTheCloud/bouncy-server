{"version":3,"sources":["app.js"],"names":["ball","document","querySelector","action","layers","querySelectorAll","tapZone","wrapper","gameView","playerNameLabel","gameOverLabel","getElementById","startLabel","warningLabel","scoreLabel","highScoreLabel","changeNameBtn","leaderboardBtn","settingsElement","quialityBtn","nameModal","leaderboardModal","leaderboardContent","leaderboardPopup","nameBtn","warningText","closeLeaderboardBtn","playerName","isInAir","gravity","isGameOver","isGameReady","position","highScore","score","speedCoefficient","clickOrTouch","qualitySettings","localStorage","getItem","textContent","allTimeouts","allObstacles","backgroundTimeouts","leaderboardAPI","control","e","key","preventDefault","restart","jump","innerHTML","style","display","newBall","createElement","i","quarter","classList","add","appendChild","generateObstacles","speedUp","baseMovementRate","start","previousTotalAnimationTime","prevPosition","positionDifference","fallDown","timestamp","totalAnimationTime","bottom","requestAnimationFrame","goUp","undefined","randomTime","Math","random","speedUpTimeoutId","setTimeout","Number","toFixed","filter","id","push","animationId","obstaclePosition","obstacle","left","moveObstacle","step","gameOver","removeChild","genTimeoutId","forEach","clearTimeout","cancelAnimationFrame","firstChild","lastChild","newLeaderboard","postHighScore","showLeaderboard","leaderboard","personal","response","fetch","method","headers","body","JSON","stringify","name","then","res","json","catch","err","showError","fetchLeaderboard","data","openLeaderboardModal","stopPropagation","player","leaderboardTable","generateTable","tableBody","playerOutOfLeaderboard","playerPosition","innerText","playerScore","closeLeaderboardModal","table","thead","tr","thPosition","thName","thScore","tbody","record","index","tdPosition","tdName","tdScore","getPersonalHighScore","generateBackground","layer","array","generateBackgroundLayer","length","arrayLength","indexFixed","timeToPassLayer","backgroundElementPosition","randomShadeOfGray","round","backgroundElement","height","width","backgroundColor","zIndex","padding","numberOfRows","parseInt","row","columns","window","animationDuration","backgroundTimoutId","setPlayerName","newName","value","trim","isValidName","RegExp","test","isNameLengthOk","removeAttribute","changeNameModal","message","errorPopup","gameWrapper","changeQuality","b","replace","remove","w","setItem","scaleGame","screen","windowWidth","scaleAmount","transform","documentElement","addEventListener","onresize"],"mappings":"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","file":"app.21843082.js","sourceRoot":"..\\src","sourcesContent":["let ball = document.querySelector('.ball')\r\nconst action = document.querySelector('.action')\r\nconst layers = document.querySelectorAll('.layer')\r\nconst tapZone = document.querySelector('.tap-zone')\r\nconst wrapper = document.querySelector('.wrapper')\r\nconst gameView = document.querySelector('.game-view')\r\n\r\n// Labels\r\nconst playerNameLabel = document.querySelector('.player-name')\r\nconst gameOverLabel = document.getElementById('game-over-label')\r\nconst startLabel = document.getElementById('start-label')\r\nconst warningLabel = document.querySelector('.warning')\r\nconst scoreLabel = document.getElementById('score')\r\nconst highScoreLabel = document.getElementById('high-score')\r\n\r\n// Menu\r\nconst changeNameBtn = document.querySelector('.change-name-btn')\r\nconst leaderboardBtn = document.querySelector('.leaderboard-btn')\r\nconst settingsElement = document.querySelector('.settings')\r\nconst quialityBtn = document.querySelector('.quality-btn')\r\n\r\n// Modals\r\nconst nameModal = document.querySelector('.modal-name')\r\nconst leaderboardModal = document.querySelector('.modal-leaderboard')\r\nconst leaderboardContent = document.querySelector('.leaderboard-wrapper')\r\nconst leaderboardPopup = document.querySelector('.modal-leaderboard .popup')\r\nconst nameBtn = document.querySelector('.name-btn')\r\nconst warningText = document.querySelector('.warning-text')\r\nconst closeLeaderboardBtn = document.querySelector('.close-leaderboard')\r\n\r\nlet isInAir = false\r\nlet gravity = 0.92\r\nlet isGameOver = true\r\nlet isGameReady = false\r\nlet position = 0\r\nlet highScore = 0\r\nlet score = 0\r\nlet speedCoefficient = 1\r\nlet playerName\r\nlet clickOrTouch = 'click'\r\nlet qualitySettings = localStorage.getItem('bouncy-quality') || 'high'\r\n\r\nquialityBtn.textContent = `Quality: ${qualitySettings}`\r\n\r\nlet allTimeouts = []\r\nlet allObstacles = []\r\nlet backgroundTimeouts = []\r\n\r\nconst leaderboardAPI = '/score/'\r\n\r\n// check for touchscreen, adapt for mobile if found\r\nif ('ontouchstart' in document.documentElement) {\r\n    clickOrTouch = 'touchstart'\r\n    tapZone.style.display = 'flex'\r\n    startLabel.innerHTML = '<h2>Tap to start</h2>'\r\n    tapZone.addEventListener('touchstart', control)\r\n    tapZone.innerHTML = 'Start'\r\n} else {\r\n    document.addEventListener('keydown', control)\r\n}\r\n\r\nfunction control(e) {\r\n    if (clickOrTouch === 'touchstart' || (clickOrTouch === 'click' && e.key === ' ')) {\r\n        e.preventDefault()\r\n        if (isGameOver && isGameReady) {\r\n            restart()\r\n        } else if (!isInAir && !isGameOver) {\r\n            jump()\r\n        }\r\n    }\r\n}\r\n\r\nfunction restart() {\r\n    score = 0\r\n    scoreLabel.innerHTML = `Score: ${score}`\r\n    position = 0\r\n    isInAir = false\r\n    speedCoefficient = 1\r\n    isGameOver = false\r\n    isGameReady = false\r\n    gameOverLabel.style.display = 'none'\r\n    tapZone.innerHTML = 'Jump'\r\n    if (!ball) {\r\n        const newBall = document.createElement('div')\r\n        for (let i = 0; i < 4; i++) {\r\n            const quarter = document.createElement('div')\r\n            quarter.classList.add('quarter')\r\n            newBall.appendChild(quarter)\r\n        }\r\n        newBall.classList.add('ball')\r\n        action.appendChild(newBall)\r\n        ball = newBall\r\n    }\r\n    generateObstacles()\r\n    speedUp()\r\n    startLabel.style.display = 'none'\r\n    settingsElement.style.display = 'none'\r\n}\r\n\r\nfunction jump() {\r\n    const baseMovementRate = 0.7\r\n    let start\r\n    let previousTotalAnimationTime\r\n    isInAir = true\r\n    let prevPosition = -10\r\n    let positionDifference\r\n\r\n    function goUp(timestamp) {\r\n        if (ball) {\r\n            if (start === undefined) {\r\n                start = timestamp\r\n                previousTotalAnimationTime = 0\r\n            }\r\n            const totalAnimationTime = timestamp - start\r\n            const timeToRenderFrame = totalAnimationTime - previousTotalAnimationTime\r\n            const step = baseMovementRate * timeToRenderFrame\r\n\r\n            position += step\r\n            position *= gravity\r\n            ball.style.bottom = position + 'px'\r\n\r\n            positionDifference = position - prevPosition\r\n\r\n            if (positionDifference > baseMovementRate && position < 200) {\r\n                requestAnimationFrame(goUp)\r\n            } else {\r\n                requestAnimationFrame(fallDown)\r\n            }\r\n            prevPosition = position\r\n            previousTotalAnimationTime = totalAnimationTime\r\n        }\r\n    }\r\n\r\n    function fallDown(timestamp) {\r\n        if (ball) {\r\n            const totalAnimationTime = timestamp - start\r\n            const timeToRenderFrame = totalAnimationTime - previousTotalAnimationTime\r\n            const step = baseMovementRate * timeToRenderFrame\r\n\r\n            position -= step\r\n            position /= gravity\r\n            if (position <= 0) {\r\n                position = 0\r\n                isInAir = false\r\n                ball.style.bottom = position + 'px'\r\n                return\r\n            }\r\n            ball.style.bottom = position + 'px'\r\n            requestAnimationFrame(fallDown)\r\n            previousTotalAnimationTime = totalAnimationTime\r\n        }\r\n    }\r\n\r\n    requestAnimationFrame(goUp)\r\n}\r\n\r\nfunction speedUp() {\r\n    let randomTime = Math.random() * 5000 + 5000\r\n\r\n    let speedUpTimeoutId = setTimeout(() => {\r\n        if (!isGameOver) {\r\n            speedCoefficient = (Number(speedCoefficient) + 0.1).toFixed(1)\r\n            speedUp()\r\n            allTimeouts = allTimeouts.filter(id => id !== speedUpTimeoutId)\r\n        }\r\n    }, randomTime)\r\n    allTimeouts.push(speedUpTimeoutId)\r\n}\r\n\r\nfunction generateObstacles() {\r\n    let randomTime = Math.random() * 3000 + 1000\r\n    let obstaclePosition = 1000\r\n    let start\r\n    let previousTotalAnimationTime\r\n    let animationId\r\n\r\n    const obstacle = document.createElement('div')\r\n    obstacle.classList.add('obstacle')\r\n    obstacle.classList.add(qualitySettings)\r\n    action.appendChild(obstacle)\r\n    obstacle.style.left = obstaclePosition + 'px'\r\n\r\n    function moveObstacle(timestamp) {\r\n        if (start === undefined) {\r\n            start = timestamp\r\n            previousTotalAnimationTime = 0\r\n        }\r\n        const totalAnimationTime = timestamp - start\r\n        const timeToRenderFrame = totalAnimationTime - previousTotalAnimationTime\r\n        const step = 0.5 * timeToRenderFrame * speedCoefficient\r\n\r\n        if (obstaclePosition > -60 && obstaclePosition < 60 && position < 60) {\r\n            gameOver()\r\n            return\r\n        } else if (obstaclePosition < -60) {\r\n            allObstacles = allObstacles.filter(id => id !== animationId)\r\n            action.removeChild(obstacle)\r\n            score += 10 * speedCoefficient\r\n            scoreLabel.innerHTML = `Score: ${score}`\r\n            return\r\n        }\r\n\r\n        obstaclePosition -= step\r\n        obstacle.style.left = obstaclePosition + 'px'\r\n\r\n        allObstacles = allObstacles.filter(id => id !== animationId)\r\n        animationId = requestAnimationFrame(moveObstacle)\r\n        allObstacles.push(animationId)\r\n        previousTotalAnimationTime = totalAnimationTime\r\n    }\r\n\r\n    animationId = requestAnimationFrame(moveObstacle)\r\n    allObstacles.push(animationId)\r\n\r\n    let genTimeoutId = setTimeout(() => {\r\n        if (!isGameOver) {\r\n            generateObstacles()\r\n            allTimeouts = allTimeouts.filter(id => id !== genTimeoutId)\r\n        }\r\n    }, randomTime)\r\n    allTimeouts.push(genTimeoutId)\r\n}\r\n\r\nasync function gameOver() {\r\n    allTimeouts.forEach(id => {\r\n        clearTimeout(id)\r\n    })\r\n    allTimeouts = []\r\n\r\n    allObstacles.forEach(id => {\r\n        cancelAnimationFrame(id)\r\n    })\r\n    allObstacles = []\r\n\r\n    gameOverLabel.style.display = 'flex'\r\n    startLabel.style.display = 'block'\r\n    settingsElement.style.display = 'flex'\r\n    isGameOver = true\r\n    while (action.firstChild) {\r\n        action.removeChild(action.lastChild)\r\n    }\r\n    ball = null\r\n    tapZone.innerHTML = 'Start'\r\n    if (score > highScore) {\r\n        isGameReady = false\r\n        leaderboardModal.style.display = 'flex'\r\n        leaderboardContent.innerHTML = '<p>Loading, please wait...</p>'\r\n\r\n        const newLeaderboard = await postHighScore()\r\n        showLeaderboard(newLeaderboard.leaderboard, newLeaderboard.personal)\r\n    } else {\r\n        isGameReady = true\r\n    }\r\n}\r\n\r\nasync function postHighScore() {\r\n    const response = await fetch(leaderboardAPI, {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({ name: playerName, score: score }),\r\n    })\r\n        .then(res => res.json())\r\n        .catch(err => {\r\n            showError(err)\r\n        })\r\n\r\n    highScore = response.personal.score\r\n    highScoreLabel.innerHTML = `High score: ${highScore}`\r\n\r\n    return response\r\n}\r\n\r\nfunction fetchLeaderboard() {\r\n    leaderboardContent.innerHTML = '<p>Loading, please wait...</p>'\r\n\r\n    fetch(leaderboardAPI)\r\n        .then(res => res.json())\r\n        .then(data => showLeaderboard(data))\r\n        .catch(err => {\r\n            showError(err)\r\n        })\r\n}\r\n\r\nfunction openLeaderboardModal(e) {\r\n    e.stopPropagation()\r\n    isGameReady = false\r\n    leaderboardModal.style.display = 'flex'\r\n    fetchLeaderboard()\r\n}\r\n\r\nfunction showLeaderboard(leaderboard, player) {\r\n    if (typeof leaderboard === 'object') {\r\n        leaderboardTable = generateTable(leaderboard)\r\n        leaderboardContent.innerHTML = ''\r\n        leaderboardContent.appendChild(leaderboardTable)\r\n\r\n        if (player) {\r\n            if (player.position < 11) {\r\n                const position = document.querySelector(`.modal-leaderboard tbody tr:nth-child(${player.position})`)\r\n                position.classList.add('player-in-leaderboard')\r\n            } else {\r\n                const tableBody = document.querySelector('.modal-leaderboard tbody')\r\n                const playerOutOfLeaderboard = document.createElement('tr')\r\n                const playerPosition = document.createElement('td')\r\n                playerPosition.innerText = player.position\r\n                const playerName = document.createElement('td')\r\n                playerName.innerText = player.name\r\n                const playerScore = document.createElement('td')\r\n                playerScore.innerText = player.score\r\n                playerOutOfLeaderboard.appendChild(playerPosition)\r\n                playerOutOfLeaderboard.appendChild(playerName)\r\n                playerOutOfLeaderboard.appendChild(playerScore)\r\n                tableBody.appendChild(playerOutOfLeaderboard)\r\n            }\r\n        }\r\n    } else if (typeof leaderboard === 'string') {\r\n        leaderboardContent.innerHTML = `<h2>${leaderboard}</h2>`\r\n    }\r\n}\r\n\r\nfunction closeLeaderboardModal(e) {\r\n    e.stopPropagation()\r\n    leaderboardModal.style.display = 'none'\r\n    isGameReady = true\r\n}\r\n\r\nfunction generateTable(leaderboard) {\r\n    const table = document.createElement('table')\r\n    const thead = document.createElement('thead')\r\n    table.appendChild(thead)\r\n    const tr = document.createElement('tr')\r\n    thead.appendChild(tr)\r\n    const thPosition = document.createElement('th')\r\n    thPosition.innerText = '#:'\r\n    const thName = document.createElement('th')\r\n    thName.innerText = 'Name:'\r\n    const thScore = document.createElement('th')\r\n    thScore.innerText = 'Score:'\r\n    tr.appendChild(thPosition)\r\n    tr.appendChild(thName)\r\n    tr.appendChild(thScore)\r\n    const tbody = document.createElement('tbody')\r\n    table.appendChild(tbody)\r\n    leaderboard.forEach((record, index) => {\r\n        const tr = document.createElement('tr')\r\n        const tdPosition = document.createElement('td')\r\n        tdPosition.innerText = index + 1\r\n        const tdName = document.createElement('td')\r\n        tdName.innerText = record.name\r\n        const tdScore = document.createElement('td')\r\n        tdScore.innerText = record.score\r\n        tr.appendChild(tdPosition)\r\n        tr.appendChild(tdName)\r\n        tr.appendChild(tdScore)\r\n        tbody.appendChild(tr)\r\n    })\r\n    return table\r\n}\r\n\r\nfunction getPersonalHighScore(name) {\r\n    fetch(`${leaderboardAPI}/${name}/`)\r\n        .then(res => res.json())\r\n        .then(data => {\r\n            if (data.score) {\r\n                highScore = data.score\r\n                highScoreLabel.innerHTML = `High score: ${highScore}`\r\n            } else {\r\n                highScore = 0\r\n                highScoreLabel.innerHTML = `High score: none`\r\n            }\r\n        })\r\n        .catch(err => {\r\n            showError(err)\r\n        })\r\n}\r\n\r\nfunction generateBackground() {\r\n    layers.forEach((layer, index, array) => {\r\n        generateBackgroundLayer(layer, index, array.length)\r\n    })\r\n}\r\n\r\nfunction generateBackgroundLayer(layer, index, arrayLength) {\r\n    const randomTime = (Math.random() * 2 + 2 / speedCoefficient) * 1000\r\n    if (qualitySettings !== 'low') {\r\n        const indexFixed = index + 1\r\n        const timeToPassLayer = 30 / indexFixed / speedCoefficient\r\n        let backgroundElementPosition = 1050\r\n        const randomShadeOfGray = Math.round(Math.random() * 10 + 60) + 20 * indexFixed\r\n\r\n        const backgroundElement = document.createElement('div')\r\n        backgroundElement.classList.add('background-element')\r\n        backgroundElement.classList.add(qualitySettings)\r\n        layer.appendChild(backgroundElement)\r\n        backgroundElement.style.left = backgroundElementPosition + 'px'\r\n        backgroundElement.style.height = Math.round(Math.random() * 60 + 60) * indexFixed + 'px'\r\n        backgroundElement.style.width = Math.round(Math.random() * 50 + 50) * indexFixed + 'px'\r\n        backgroundElement.style.backgroundColor = `rgb(${randomShadeOfGray}, ${randomShadeOfGray}, ${randomShadeOfGray + 40})`\r\n        backgroundElement.style.zIndex = indexFixed\r\n        backgroundElement.style.padding = 10 * indexFixed + 'px'\r\n\r\n        const numberOfRows = Math.round((parseInt(backgroundElement.style.height) - 25) / (30 * indexFixed))\r\n\r\n        if (qualitySettings === 'high') {\r\n            // create rows of windows\r\n            for (let i = 0; i < numberOfRows; i++) {\r\n                const row = document.createElement('div')\r\n                row.classList.add('row')\r\n                backgroundElement.appendChild(row)\r\n\r\n                const columns = parseInt(backgroundElement.style.width) > 20 * indexFixed * 3 ? 3 : 2\r\n\r\n                // create columns of windows\r\n                for (let i = 0; i < columns; i++) {\r\n                    const window = document.createElement('div')\r\n                    window.classList.add('window')\r\n                    window.style.height = 10 * indexFixed + 'px'\r\n                    window.style.width = 10 * indexFixed + 'px'\r\n                    row.appendChild(window)\r\n                }\r\n            }\r\n        }\r\n\r\n        backgroundElement.style.animationDuration = timeToPassLayer + 's'\r\n\r\n        let backgroundTimoutId = setTimeout(() => {\r\n            layer.removeChild(backgroundElement)\r\n            backgroundTimeouts.filter(id => id !== backgroundTimoutId)\r\n        }, timeToPassLayer * 1000)\r\n        backgroundTimeouts.push(backgroundTimoutId)\r\n    }\r\n\r\n    setTimeout(() => {\r\n        generateBackgroundLayer(layer, index, arrayLength)\r\n    }, randomTime)\r\n}\r\n\r\nfunction setPlayerName(e) {\r\n    e.preventDefault()\r\n    const newName = document.getElementById('name').value.trim()\r\n    const nameRegExp = new RegExp(/^[a-z0-9]+$/i)\r\n\r\n    let isValidName = nameRegExp.test(newName)\r\n    let isNameLengthOk = newName.length > 2 && newName.length < 14\r\n\r\n    if (isValidName && isNameLengthOk) {\r\n        playerName = newName\r\n        nameModal.style.display = 'none'\r\n        isGameReady = true\r\n        startLabel.style.display = 'block'\r\n        settingsElement.style.display = 'flex'\r\n\r\n        playerNameLabel.innerHTML = playerName\r\n        getPersonalHighScore(playerName)\r\n    } else if (!isValidName) {\r\n        warningLabel.removeAttribute('hidden')\r\n        warningText.innerHTML = 'Only letters and numbers are allowed.'\r\n    } else {\r\n        warningLabel.removeAttribute('hidden')\r\n        warningText.innerHTML = 'Minimum 3, maximum 13 characters'\r\n    }\r\n    return false\r\n}\r\n\r\nfunction changeNameModal(e) {\r\n    nameModal.style.display = 'flex'\r\n    isGameReady = false\r\n    startLabel.style.display = 'none'\r\n    settingsElement.style.display = 'none'\r\n}\r\n\r\nfunction showError(message) {\r\n    const errorPopup = document.createElement('div')\r\n    const gameWrapper = document.querySelector('.wrapper')\r\n    errorPopup.innerHTML = `<p>Something went wrong: ${message}</p>`\r\n    errorPopup.classList.add('error-popup')\r\n    gameWrapper.appendChild(errorPopup)\r\n\r\n    setTimeout(() => {\r\n        gameWrapper.removeChild(errorPopup)\r\n    }, 5000)\r\n}\r\n\r\nfunction changeQuality(e) {\r\n    e.stopPropagation()\r\n    if (qualitySettings === 'low') {\r\n        qualitySettings = 'high'\r\n        document.querySelectorAll('.background-element').forEach(b => b.classList.replace('low', 'high'))\r\n    } else if (qualitySettings === 'mid') {\r\n        qualitySettings = 'low'\r\n        document.querySelectorAll('.background-element').forEach(b => b.remove())\r\n        backgroundTimeouts.forEach(id => {\r\n            clearTimeout(id)\r\n        })\r\n        backgroundTimeouts = []\r\n    } else if (qualitySettings === 'high') {\r\n        qualitySettings = 'mid'\r\n        document.querySelectorAll('.window').forEach(w => w.remove())\r\n        document.querySelectorAll('.background-element').forEach(b => b.classList.replace('high', 'mid'))\r\n    }\r\n    localStorage.setItem('bouncy-quality', qualitySettings)\r\n    quialityBtn.textContent = `Quality: ${qualitySettings}`\r\n}\r\n\r\nnameBtn.addEventListener(clickOrTouch, setPlayerName)\r\nchangeNameBtn.addEventListener(clickOrTouch, changeNameModal)\r\nleaderboardBtn.addEventListener(clickOrTouch, openLeaderboardModal)\r\ncloseLeaderboardBtn.addEventListener(clickOrTouch, closeLeaderboardModal)\r\nquialityBtn.addEventListener(clickOrTouch, changeQuality)\r\n\r\n// Fix for mobile\r\n\r\nwindow.onresize = scaleGame\r\n\r\nfunction scaleGame() {\r\n    if (screen.width < 1000) {\r\n        const windowWidth = screen.width\r\n        wrapper.classList.add('fullscreen')\r\n        const scaleAmount = windowWidth / 1100\r\n        gameView.style.transform = `scale(${scaleAmount > 1 ? 1 : scaleAmount})`\r\n        tapZone.style.transform = `scale(${scaleAmount > 1 ? 1 : scaleAmount}) translateY(-50%)`\r\n    } else {\r\n        wrapper.classList.remove('fullscreen')\r\n        gameView.style.transform = ''\r\n        tapZone.style.transform = 'translateY(-50%)'\r\n    }\r\n}\r\n\r\nscaleGame()\r\n\r\ngenerateBackground()\r\n"]}